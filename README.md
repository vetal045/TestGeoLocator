# Project Overview

This project is a **high-performance IP geolocation lookup system**, designed with an emphasis on speed, memory efficiency, clean architecture, and professional-grade C++ practices. It efficiently loads large IP databases and enables fast lookups with minimal memory footprint.

The system includes:
- Binary database preprocessor
- Highly optimized IP lookup engine
- Modular command handling
- Professional build system and unit tests

It is developed targeting macOS ARM64 (M1) but remains portable across POSIX systems.

---

# Project Structure

| Path | Purpose |
|:-----|:--------|
| `src/locator/` | IP lookup engine (`GeoLocator`, `VectorGeoRecordProvider`) |
| `src/loaders/` | Loading `.geo` binary database files (`BinaryGeoDatabaseLoader`) |
| `src/command/` | Command parser and handlers (LOAD, LOOKUP, EXIT) |
| `src/service/` | `CommandService` that dispatches parsed commands |
| `preprocessor/` | Preprocessor: converts CSV to efficient binary `.geo` format |
| `include/` | Common data structures and interfaces |
| `data/` | Dataset files: `database.csv`, `database.geo` |
| `tests/` | Unit tests using GoogleTest |
| `docs/` | Documentation generated by Doxygen |

---

# Requirements

- macOS ARM64 (Apple Silicon M1+)
- CMake >= 3.16
- Make
- GCC >= 10 or Apple Clang with full C++17/20 support
- Python 3.8+ (for performance testing)
- Coreutils (`realpath`) - install via `brew install coreutils` on macOS
- Doxygen (optional, for documentation)

---

# Build and Installation

## Full rebuild and testing:
```bash
./make.sh --full-rebuild
```

## Build only:
```bash
./make.sh --build-only
```

## Run unit tests:
```bash
./make.sh --test
```

Scripts automatically configure the project and handle dependencies via CMake.

---

# Preprocessing the Database

CSV format is inefficient for runtime loading. Preprocessing to binary `.geo` format accelerates startup and reduces RAM usage.

To preprocess:
```bash
./preprocess.sh ./data/database.csv ./data/database.geo
```

Advantages of `.geo` format:
- Direct memory mapping
- No parsing overhead
- Faster load (~4× improvement)

---

# Running the Application

Performance validation and functional tests:

```bash
python3 geolocation_test.py \
    --executable ./build/geolocator/geolocator \
    --database ./data/database.geo
```

Example output:
```text
Database loaded Memory usage: 540.41mb Load time: 838ms
OK    1.0.0.0 US Los Angeles Lookup time: 84μs
...
Final points for 10 measurements: 6284.404
```

---

# Running Unit Tests

After building:
```bash
ctest --output-on-failure
```
Or simply:
```bash
./make.sh --test
```

---

# Optimization Highlights

- Simplified IP lookup using sorted records + `std::lower_bound`
- Dropped chunk-based design for better cache performance
- Direct memory mapping of `.geo` database
- Manual fast IP string-to-integer conversion
- Minimal heap allocations during runtime
- Use of modern C++ smart pointers and containers

---

# Challenges and Solutions

| Challenge | Solution |
|:----------|:---------|
| Slow CSV parsing at startup | Introduced binary preprocessor tool |
| Memory overhead with large datasets | Optimized binary layout and mmap |
| Process tracking failures (`psutil`) | Improved child process management |
| Lookup time performance | Optimized with sorted storage + binary search |

---

# Potential Improvements

- Implement Radix Tree or Compressed Trie for O(log n) or O(1) lookups
- Parallel loading using multiple threads
- SIMD optimizations for bulk IP parsing
- Dynamic database reloading
- HTTP API for remote lookups
- Support for IPv6 datasets

**Note:** Current implementation strikes a balance between code complexity, speed, and deadline constraints. Many future improvements were considered but deemed out of scope for this phase.

---

# External Libraries Used

- [fast-cpp-csv-parser](https://github.com/ben-strasser/fast-cpp-csv-parser) (BSD License)
  - High-performance CSV parsing for preprocessor

The project complies fully with the BSD license requirements.

---

# FAQ / Troubleshooting

| Problem | Solution |
|:--------|:---------|
| `realpath` command not found | Install GNU coreutils: `brew install coreutils` |
| Slow database load using `.csv` | Use `preprocess.sh` to generate `.geo` binary database |
| Missing `Makefile` during build | Ensure build directory is created and `cmake ..` executed |
| Python psutil crash on macOS | Ensure psutil is installed correctly with `pip install psutil` |

---

# License

This project is licensed under the **MIT License**.

It also incorporates the **fast-cpp-csv-parser** library, licensed under the **BSD License**.

---

# Author

Developed by **Vitalii Ryzhov** for a technical assessment, with a strong focus on clean architecture, performance, and production-readiness.

---

